# ADR-002: Use `openapi-ts` for Type-Safe API Client Generation

**Date**: 2025-07-07
**Status**: Accepted
**Deciders**: Frontend Team, Backend Team

## Context

To ensure robust communication between our FastAPI backend and Next.js frontend, we need a reliable way to make API calls. Manually writing `fetch` requests and TypeScript types is time-consuming, error-prone, and leads to a disconnect when the API schema changes. We need an automated solution that guarantees type safety from the backend to the frontend.

## Decision Drivers

* **End-to-End Type Safety**: Eliminate runtime errors by ensuring API request/response cycles are fully typed.
* **Developer Experience**: Reduce boilerplate code and simplify the process of interacting with the API.
* **Maintainability**: Automate updates to the frontend's API layer whenever the backend schema evolves.
* **Reliability**: Ensure the frontend client is always perfectly synchronized with the backend's OpenAPI specification.

## Considered Options

1.  **`openapi-ts` (from hey-api)**: Generates a complete, ready-to-use, and type-safe client with functions for every API endpoint.
2.  **`openapi-typescript`**: A lighter tool that generates only TypeScript interfaces from the OpenAPI schema, requiring developers to still write their own `fetch` or `axios` logic.
3.  **Manual Implementation**: Manually writing API fetching functions and defining all TypeScript types by hand. This approach offers no automation and is highly brittle.

## Decision Outcome

**Chosen option: `openapi-ts`**.

We have chosen `openapi-ts` because it provides a complete, out-of-the-box solution. Instead of just generating types, it creates a fully functional client. This dramatically reduces boilerplate and eliminates an entire class of potential bugs by automating both the type definitions and the implementation of API calls.

### Positive Consequences

* **Complete Type Safety**: Every part of an API call—function arguments, request bodies, query parameters, and response data—is strongly typed. This allows TypeScript to catch errors at compile-time, not in production.
* **Zero Boilerplate for API Calls**: Developers no longer write `fetch` or `axios` wrappers. They simply import a function and call it, for example: `await client.notes.createNote({ body: newNote })`. This makes component code cleaner and more focused on business logic.
* **Effortless API Updates**: When the backend API changes (e.g., a new endpoint is added or a model is modified), the frontend client is updated by running a single command. This avoids the tedious and error-prone process of manually updating dozens of files.
* **Enhanced IDE Experience**: Developers get rich autocompletion for API services, methods, and their expected parameters directly in their editor, significantly speeding up development and reducing the need to consult API documentation.
* **Guaranteed Synchronization**: The generated client acts as a contract that is always in sync with the backend's `openapi.json` schema, preventing mismatches between frontend expectations and backend behavior.

### Negative Consequences

* **Build-Step Dependency**: Introduces an extra step in the development and CI/CD process to generate the client.
* **Abstraction Layer**: The generated code can be complex, potentially acting as a "black box" that might be difficult to debug in rare edge cases.
### Implementation Notes

**Technical Implementation:**
- Client generation script: `npm run generate-client` executes `openapi-ts --input http://localhost:8000/openapi.json --output ./src/lib/api`
- Generated client stored in `src/lib/api/` with auto-generated TypeScript interfaces and service functions
- Integration with existing HTTP client using configurable base URL and authentication headers
- Pre-commit hook ensures client regeneration when OpenAPI schema changes

**Patterns Used:**
- Service-oriented architecture: Generated client organizes endpoints into logical service groups
- Configuration pattern: Client accepts configuration object for base URL, headers, and interceptors
- Promise-based API with proper error handling and type-safe responses

**Future Considerations:**
- Monitor performance impact of large generated clients and consider code splitting if needed
- Evaluate migration path to newer versions of `openapi-ts` as the library evolves
- Consider implementing custom templates for specific organizational needs

### References

- [openapi-ts Documentation](https://github.com/hey-api/openapi-ts)
- [FastAPI OpenAPI Documentation](https://fastapi.tiangolo.com/tutorial/metadata/)
- [TypeScript Handbook - Advanced Types](https://www.typescriptlang.org/docs/handbook/2/types-from-types.html)
- [OpenAPI 3.0 Specification](https://swagger.io/specification/)

## Compliance

All frontend communication with the FastAPI backend must be performed using the client generated by `openapi-ts`. A script for regenerating the client will be added to the `package.json` and integrated into our development workflow to ensure the client is always up-to-date.